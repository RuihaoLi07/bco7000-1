----------------------------------------------------------------------------------------------------------------
# Title: "Assignment 2"
# Author: "Ruihao Li-s4648220"
# Date: "19/01/2022"

### Part 1: Formatting RMarkdown document (2 marks)


```{r}
#loading required libraries
library(tidyverse)
thanks<-read.csv("C:\\Users\\Lenovo\\Desktop\\thanksgiving_meal.csv")

thanks %>%
 group_by(us_region) %>%
 summarize(count=n())

```

***

### Part 2: Data Wrangling and visualization 38 marks

### Data Cleaning


```{r}
thanks_clean <- thanks %>%
      filter((thanks$us_region!=""))

thanks_clean %>%
 group_by(us_region) %>%
 summarize(count=n())
 
 thanks_clean1 <- thanks_clean %>%
      filter((thanks_clean$age!=""))


thanks_clean1 %>%
 group_by(age) %>%
 summarize(count=n())
 
 
 thanks_clean2 <- thanks_clean1 %>%
      filter((thanks_clean1$community_type!=""))

thanks_clean2 %>%
 group_by(community_type) %>%
 summarize(count=n())
 
 thanks_clean3 <- thanks_clean2 %>%
      filter((thanks_clean2$main_dish!=""))

thanks_clean3 %>%
 group_by(main_dish) %>%
 summarize(count=n())

```

***

### Displaying first 10 rows of the dataset

```{r}
# First 10 rows
knitr::kable(head(thanks[, 1:7]), rows=10, caption = "Displaying first 10 rows")

```

***

### Summary of variables

```{r}
#Summary of variables
library(skimr)
skim(thanks) 

```

***
### Variables to predict family income

The following are the potential variables that would help predict family income;
1) Gender
2) Age
3) Us region
All the variables are correct type.

### Variables to predict community type or US_region

The following are the potential variables that would help predict community type or US_region;
1) Gender
2) Age
3) Us region
All the variables are correct type.

***
### Number of people who celebrate

```{r}
thanks %>%
 group_by(celebrate) %>%
 summarize(count=n())

```

From the above results, it can be seen that 980 people celebrate.

***
### Categories of main dish

```{r}
thanks %>%
 group_by(main_dish) %>%
 summarize(count=n())

```

***


### Data Visualization


```{r}
ggplot(thanks_clean2, mapping = aes(thanks_clean2$community_type))+
    geom_bar(aes(fill=thanks_clean2$age))+
    xlab('Community Region')+labs(fill='Age group')+geom_text(stat='count',aes(label = ..count..,y=..count..),vjust=-0.2)+
    ggtitle('Thanksgiving data')

```

***


```{r}
ggplot(thanks_clean, mapping = aes(thanks_clean$us_region))+
    geom_bar(aes(fill=thanks_clean$gender))+
    xlab('US Region')+labs(fill='Gender')+geom_text(stat='count',aes(label = ..count..,y=..count..),vjust=-0.2)+
    theme(axis.text.x = element_text(angle = 90))+
    ggtitle('Thanksgiving data')

```

***


```{r}
ggplot(thanks_clean, mapping = aes(thanks_clean$us_region))+
    geom_bar(aes(fill=thanks_clean$age))+
    xlab('US Region')+labs(fill='Age group')+geom_text(stat='count',aes(label = ..count..,y=..count..),vjust=-0.2)+
    theme(axis.text.x = element_text(angle = 90))+
    ggtitle('Thanksgiving data')

```

***


```{r}
ggplot(thanks_clean, mapping = aes(thanks_clean$us_region))+
    geom_bar(aes(fill=thanks_clean$family_income))+
    xlab('US Region')+labs(fill='Family Income')+geom_text(stat='count',aes(label = ..count..,y=..count..),vjust=-0.2)+
    theme(axis.text.x = element_text(angle = 90))+
    ggtitle('Thanksgiving data')

```

***


```{r}
ggplot(thanks_clean3, mapping = aes(thanks_clean3$main_dish))+
    geom_bar(aes(fill=thanks_clean3$friendsgiving))+
    xlab('Main Dish')+labs(fill='Friends giving')+geom_text(stat='count',aes(label = ..count..,y=..count..),vjust=-0.2)+
    theme(axis.text.x = element_text(angle = 90))+
    ggtitle('Thanksgiving data')

```

***

### Number of Cranberry sauce

```{r}
thanks %>%
 group_by(cranberry) %>%
 summarize(count=n())

```

From the above, 974 people use cranberry sauce.

### Number of gravy

```{r}
thanks %>%
 group_by(gravy) %>%
 summarize(count=n())

```

From the above, 892 use gravy.

### Creating new dataset

```{r}
library(tidyverse)

thanks_food<-thanks%>% select(id, starts_with("side"),
starts_with("pie"),
starts_with("dessert")) %>%
select(-side15, -pie13, -dessert12) %>%
gather(type, value, -id) %>%
filter(!is.na(value),
!value %in% c("None", "Other (please specify)")) %>%
mutate(type = str_remove(type, "\\\\d+"))

```

The above code presents the data into long format with 3 columns (id, type and value)

### Installing package widyr

```{r}
library("widyr")
attach(thanks_food)

```

### Using pairwise_cor

```{r}
food_cors <- thanks_food %>%
  pairwise_cor(value, id, sort = TRUE)
food_cors
```

The above output shows that the highest correlation is between cookies and brownies (r = 0.411) followed by Sweet Potato and Macaroni and cheese (r = 0.365). The correlation between Pumpkin and Mashed potatoes was 0.290.


### Conclusion

In the primary dataset, there are 1058 data points and 65 characteristics. It looks that 68 people replied yes and 931 people said no after constructing the subset, cleaning it for the "US Region," and completing the data visualization. Also, based on the plot, it appears that Thanksgiving is a popular holiday in the suburbs. Thanksgiving is most popular in the "south atlantic" region and least popular in the "mountain" region among the many US regions.
